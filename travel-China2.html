<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>中国旅行 - 実地形の全国地図</title>
<style>
  :root{
    --bg1:#5c5ad7; --bg2:#a58be0; --panel:#ffffff22; --ink:#fff;
    --area:#88b34a; --hover:#f0a500; --border:#fff;
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 50% -10%,var(--bg2),var(--bg1));font-family:system-ui,Segoe UI,"Noto Sans JP",sans-serif;color:var(--ink)}
  header{position:sticky;top:0;background:#f8e6c9; color:#222; padding:12px 18px; box-shadow:0 8px 30px #0003; border-bottom:4px solid #d9a86c}
  main{max-width:1180px;margin:22px auto;padding:0 12px}
  .stage{display:grid;grid-template-columns: 1.25fr .9fr; gap:22px}
  .panel{background:var(--panel); border-radius:18px; padding:14px; backdrop-filter: blur(10px); box-shadow:0 20px 40px #0004}
  h1{margin:4px 6px 10px; letter-spacing:.06em; text-shadow:0 3px 10px #0006}
  #map{width:100%;height:560px;border-radius:12px}
  .detail h2{margin:.2rem 0 .6rem; font-size:26px; text-align:center; color:#ffd25e; text-shadow:0 2px 8px #0006}
  .card{background:#ffffffb8;border-radius:14px;padding:12px;color:#222;box-shadow:inset 0 1px 0 #fff8,0 10px 24px #0002}
  .hero{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:4px solid #e8d2a7;box-shadow:0 8px 16px #0002}
  .mute{opacity:.75}
  @media (max-width:980px){.stage{grid-template-columns:1fr} #map{height:520px}}
</style>
<!-- ECharts -->
<script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
<header>🏞 中国旅行マップ（実地形）</header>

<main class="stage">
  <section class="panel">
    <h1>中国地図（省・自治区・直轄市 + 台湾）</h1>
    <div id="map" aria-label="China provinces map"></div>
  </section>

  <aside class="panel detail">
    <h2 id="title" class="mute">地域を選択してください</h2>
    <div class="card">
      <img id="photo" class="hero" src="" alt="" />
      <p id="desc" class="mute" style="line-height:1.7;margin:.8rem 0 0">
        地図をクリックすると写真と説明がここに表示されます。
      </p>
    </div>
  </aside>
</main>

<script>
(async function(){
  // ▼ 同じフォルダに置いたあなたのGeoJSONファイル名
  const CHINA_FILE  = './china-provinces.geojson.json';
  const TAIWAN_FILE = './Taiwan.geojson.json';

  // 地域情報（任意で追記）
  const info = {
    "西藏|Tibet": {
      img:"https://images.unsplash.com/photo-1544735716-392fe2489ffa?q=80&w=1280&auto=format&fit=crop",
      desc:"世界の屋根・雪域高原の神秘的な土地。ラサ、ナムツォ、エベレスト北側BCなど。"
    },
    "新疆|Xinjiang": {
      img:"https://images.unsplash.com/photo-1535747790212-30c585ab4862?q=80&w=1280&auto=format&fit=crop",
      desc:"シルクロードの交差点。トルファン、喀什、天山、胡楊林、シシカバブ！"
    },
    "北京|Beijing": {
      img:"https://images.unsplash.com/photo-1557579112-2d0f6d5f5d02?q=80&w=1280&auto=format&fit=crop",
      desc:"紫禁城・天壇・長城。歴史遺産と近代都市が同居。"
    },
    "上海|Shanghai": {
      img:"https://images.unsplash.com/photo-1505764706515-aa95265c5abc?q=80&w=1280&auto=format&fit=crop",
      desc:"外灘と浦東の摩天楼、租界建築と近未来が交差。"
    }
  };

  function labelName(props={}){
    // 多言語の表記ゆれに耐性（手持ちのGeoJSONのプロパティに合わせて適宜追加）
    return props.name_ja || props.name || props.NAME || props.name_zh || props.Name || props.NAME_1 || '';
  }

  async function loadJSON(p){ const r=await fetch(p); if(!r.ok) throw new Error(p+': '+r.status); return r.json(); }

  // 1) GeoJSONを読み込み・マージ（FeatureCollection同士を結合）
  const [cn, tw] = await Promise.all([loadJSON(CHINA_FILE), loadJSON(TAIWAN_FILE)]);
  const featuresCN = Array.isArray(cn) ? cn : (cn.features || []);
  const featuresTW = Array.isArray(tw) ? tw : (tw.features || []);
  const merged = { type:'FeatureCollection', features:[...featuresCN, ...featuresTW] };

  // 2) 地図登録
  echarts.registerMap('china_full', merged, {});
  const chart = echarts.init(document.getElementById('map'));

  chart.setOption({
    backgroundColor:'transparent',
    tooltip:{
      trigger:'item',
      formatter:(p)=>{
        const props = p.data?.properties || {};
        return '📍 ' + (labelName(props) || p.name || '地域');
      }
    },
    geo:{
      map:'china_full',
      roam:true,
      center:[104,35.5],
      zoom:1.05,
      label:{ show:false },
      itemStyle:{
        areaColor:'var(--area)',
        borderColor:'var(--border)',
        borderWidth:.9,
        shadowColor:'rgba(0,0,0,.28)',
        shadowBlur:10,
        shadowOffsetY:6
      },
      emphasis:{
        label:{ show:false },
        itemStyle:{ areaColor:'var(--hover)', borderColor:'#ffd25e', borderWidth:2 }
      }
    },
    series:[{
      type:'map',
      map:'china_full',
      nameProperty:'name',
      data:(merged.features||[]).map(f=>({
        name:labelName(f.properties||{}),
        value:1,
        properties:f.properties||{}
      }))
    }]
  });

  // 3) クリックで右ペイン更新
  chart.on('click', (params)=>{
    const props = params.data?.properties || {};
    const name = labelName(props) || params.name || '不明';
    document.getElementById('title').textContent = name;
    document.getElementById('title').classList.remove('mute');

    // infoに一致するものがあれば表示
    const key = Object.keys(info).find(k => k.split('|').some(x => name.includes(x)));
    const photo = document.getElementById('photo');
    const desc  = document.getElementById('desc');
    if(key){
      photo.src = info[key].img;
      photo.alt = name;
      desc.textContent = info[key].desc;
      desc.classList.remove('mute');
    }else{
      photo.src = '';
      photo.alt = '';
      desc.textContent = 'この地域の説明は未設定です。右上の info マップへ追加してください。';
      desc.classList.add('mute');
    }
  });

  window.addEventListener('resize', ()=>chart.resize());
})();
</script>
</body>
</html>
