<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ä¸­å›½æ—…è¡Œ - å®Ÿåœ°å½¢ã®å…¨å›½åœ°å›³</title>
<style>
  :root{
    --bg1:#5c5ad7; --bg2:#a58be0; --panel:#ffffff22; --ink:#fff;
    --area:#88b34a; --hover:#f0a500; --border:#fff;
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 50% -10%,var(--bg2),var(--bg1));font-family:system-ui,Segoe UI,"Noto Sans JP",sans-serif;color:var(--ink)}
  header{position:sticky;top:0;background:#f8e6c9; color:#222; padding:12px 18px; box-shadow:0 8px 30px #0003; border-bottom:4px solid #d9a86c}
  main{max-width:1180px;margin:22px auto;padding:0 12px}
  .stage{display:grid;grid-template-columns: 1.25fr .9fr; gap:22px}
  .panel{background:var(--panel); border-radius:18px; padding:14px; backdrop-filter: blur(10px); box-shadow:0 20px 40px #0004}
  h1{margin:4px 6px 10px; letter-spacing:.06em; text-shadow:0 3px 10px #0006}
  #map{width:100%;height:560px;border-radius:12px}
  .detail h2{margin:.2rem 0 .6rem; font-size:26px; text-align:center; color:#ffd25e; text-shadow:0 2px 8px #0006}
  .card{background:#ffffffb8;border-radius:14px;padding:12px;color:#222;box-shadow:inset 0 1px 0 #fff8,0 10px 24px #0002}
  .hero{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:4px solid #e8d2a7;box-shadow:0 8px 16px #0002}
  .mute{opacity:.75}
  @media (max-width:980px){.stage{grid-template-columns:1fr} #map{height:520px}}
</style>
<!-- ECharts -->
<script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
<header>ğŸ ä¸­å›½æ—…è¡Œãƒãƒƒãƒ—ï¼ˆå®Ÿåœ°å½¢ï¼‰</header>

<main class="stage">
  <section class="panel">
    <h1>ä¸­å›½åœ°å›³ï¼ˆçœãƒ»è‡ªæ²»åŒºãƒ»ç›´è½„å¸‚ + å°æ¹¾ï¼‰</h1>
    <div id="map" aria-label="China provinces map"></div>
  </section>

  <aside class="panel detail">
    <h2 id="title" class="mute">åœ°åŸŸã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
    <div class="card">
      <img id="photo" class="hero" src="" alt="" />
      <p id="desc" class="mute" style="line-height:1.7;margin:.8rem 0 0">
        åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å†™çœŸã¨èª¬æ˜ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      </p>
    </div>
  </aside>
</main>

<script>
(async function(){
  // â–¼ åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã„ãŸã‚ãªãŸã®GeoJSONãƒ•ã‚¡ã‚¤ãƒ«å
  const CHINA_FILE  = './china-provinces.geojson.json';
  const TAIWAN_FILE = './Taiwan.geojson.json';

  // åœ°åŸŸæƒ…å ±ï¼ˆä»»æ„ã§è¿½è¨˜ï¼‰
  const info = {
    "è¥¿è—|Tibet": {
      img:"https://images.unsplash.com/photo-1544735716-392fe2489ffa?q=80&w=1280&auto=format&fit=crop",
      desc:"ä¸–ç•Œã®å±‹æ ¹ãƒ»é›ªåŸŸé«˜åŸã®ç¥ç§˜çš„ãªåœŸåœ°ã€‚ãƒ©ã‚µã€ãƒŠãƒ ãƒ„ã‚©ã€ã‚¨ãƒ™ãƒ¬ã‚¹ãƒˆåŒ—å´BCãªã©ã€‚"
    },
    "æ–°ç–†|Xinjiang": {
      img:"https://images.unsplash.com/photo-1535747790212-30c585ab4862?q=80&w=1280&auto=format&fit=crop",
      desc:"ã‚·ãƒ«ã‚¯ãƒ­ãƒ¼ãƒ‰ã®äº¤å·®ç‚¹ã€‚ãƒˆãƒ«ãƒ•ã‚¡ãƒ³ã€å–€ä»€ã€å¤©å±±ã€èƒ¡æ¥Šæ—ã€ã‚·ã‚·ã‚«ãƒãƒ–ï¼"
    },
    "åŒ—äº¬|Beijing": {
      img:"https://images.unsplash.com/photo-1557579112-2d0f6d5f5d02?q=80&w=1280&auto=format&fit=crop",
      desc:"ç´«ç¦åŸãƒ»å¤©å£‡ãƒ»é•·åŸã€‚æ­´å²éºç”£ã¨è¿‘ä»£éƒ½å¸‚ãŒåŒå±…ã€‚"
    },
    "ä¸Šæµ·|Shanghai": {
      img:"https://images.unsplash.com/photo-1505764706515-aa95265c5abc?q=80&w=1280&auto=format&fit=crop",
      desc:"å¤–ç˜ã¨æµ¦æ±ã®æ‘©å¤©æ¥¼ã€ç§Ÿç•Œå»ºç¯‰ã¨è¿‘æœªæ¥ãŒäº¤å·®ã€‚"
    }
  };

  function labelName(props={}){
    // å¤šè¨€èªã®è¡¨è¨˜ã‚†ã‚Œã«è€æ€§ï¼ˆæ‰‹æŒã¡ã®GeoJSONã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«åˆã‚ã›ã¦é©å®œè¿½åŠ ï¼‰
    return props.name_ja || props.name || props.NAME || props.name_zh || props.Name || props.NAME_1 || '';
  }

  async function loadJSON(p){ const r=await fetch(p); if(!r.ok) throw new Error(p+': '+r.status); return r.json(); }

  // 1) GeoJSONã‚’èª­ã¿è¾¼ã¿ãƒ»ãƒãƒ¼ã‚¸ï¼ˆFeatureCollectionåŒå£«ã‚’çµåˆï¼‰
  const [cn, tw] = await Promise.all([loadJSON(CHINA_FILE), loadJSON(TAIWAN_FILE)]);
  const featuresCN = Array.isArray(cn) ? cn : (cn.features || []);
  const featuresTW = Array.isArray(tw) ? tw : (tw.features || []);
  const merged = { type:'FeatureCollection', features:[...featuresCN, ...featuresTW] };

  // 2) åœ°å›³ç™»éŒ²
  echarts.registerMap('china_full', merged, {});
  const chart = echarts.init(document.getElementById('map'));

  chart.setOption({
    backgroundColor:'transparent',
    tooltip:{
      trigger:'item',
      formatter:(p)=>{
        const props = p.data?.properties || {};
        return 'ğŸ“ ' + (labelName(props) || p.name || 'åœ°åŸŸ');
      }
    },
    geo:{
      map:'china_full',
      roam:true,
      center:[104,35.5],
      zoom:1.05,
      label:{ show:false },
      itemStyle:{
        areaColor:'var(--area)',
        borderColor:'var(--border)',
        borderWidth:.9,
        shadowColor:'rgba(0,0,0,.28)',
        shadowBlur:10,
        shadowOffsetY:6
      },
      emphasis:{
        label:{ show:false },
        itemStyle:{ areaColor:'var(--hover)', borderColor:'#ffd25e', borderWidth:2 }
      }
    },
    series:[{
      type:'map',
      map:'china_full',
      nameProperty:'name',
      data:(merged.features||[]).map(f=>({
        name:labelName(f.properties||{}),
        value:1,
        properties:f.properties||{}
      }))
    }]
  });

  // 3) ã‚¯ãƒªãƒƒã‚¯ã§å³ãƒšã‚¤ãƒ³æ›´æ–°
  chart.on('click', (params)=>{
    const props = params.data?.properties || {};
    const name = labelName(props) || params.name || 'ä¸æ˜';
    document.getElementById('title').textContent = name;
    document.getElementById('title').classList.remove('mute');

    // infoã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ãŒã‚ã‚Œã°è¡¨ç¤º
    const key = Object.keys(info).find(k => k.split('|').some(x => name.includes(x)));
    const photo = document.getElementById('photo');
    const desc  = document.getElementById('desc');
    if(key){
      photo.src = info[key].img;
      photo.alt = name;
      desc.textContent = info[key].desc;
      desc.classList.remove('mute');
    }else{
      photo.src = '';
      photo.alt = '';
      desc.textContent = 'ã“ã®åœ°åŸŸã®èª¬æ˜ã¯æœªè¨­å®šã§ã™ã€‚å³ä¸Šã® info ãƒãƒƒãƒ—ã¸è¿½åŠ ã—ã¦ãã ã•ã„ã€‚';
      desc.classList.add('mute');
    }
  });

  window.addEventListener('resize', ()=>chart.resize());
})();
</script>
</body>
</html>
